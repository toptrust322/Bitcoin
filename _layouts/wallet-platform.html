---
# This file is licensed under the MIT License (MIT) available on
# http://opensource.org/licenses/MIT.

layout: base
---

<div class="hero">
  <div class="container hero-container">
    <h1>{% translate pagetitle choose-your-wallet %}</h1>
    <p class="summary">{% translate pagedesc choose-your-wallet %}</p>
    {% include helpers/hero-social.html %}
  </div>
</div>

{% include layout/base/helper-intro.html %}
{% include layout/base/helper-wizard.html %}
{% include layout/base/wallets-selector.html %}

<script>
(function() {
  var selectedPlatform;
  var selectedUser;
  var selectedImportantCheckboxes = [];
  var selectedImportantCheckboxes = [];
  var accordionsList = document.querySelectorAll('.js-helper-accordion');
  var headersList = document.querySelectorAll('.helper-header');
  var linksList = document.querySelectorAll('.wallet-link');  
  var selectorsList = document.querySelectorAll('.js-wallet-selector');
  
  function displayRelevantScreen(relevantScreenName) {
    var screens = document.querySelectorAll('[data-screen-name]')
    screens.forEach(function(screen) {
      if (screen.dataset.screenName ===  relevantScreenName) screen.classList.add('visible');
      else screen.classList.remove('visible');
    })
  }
  
  function displaySelectedHeaderValues(accordionType, selectedFilters, accordion) {
    if (selectedFilters && accordionType === 'important' || accordionType === 'features') {
      var text = selectedFilters.split(',').map(function(s) {
        return s.split('_').join(' ');
      }).join(', ');
      accordion.querySelector('.helper-selected-filter').textContent = text;
    } else if (selectedFilters) {
      var text = document.querySelector('input[value=' + selectedFilters + ']').dataset.text;
      accordion.querySelector('.helper-selected-filter').textContent = text;
    }
  }
  
  function openRelevantStepAccordion(selectedStep, accordionStep, accordion) {
    if (selectedStep === accordionStep) accordion.classList.add('active');
    else accordion.classList.remove('active');
  }

  function highlightCompletedHeader(selectedFilters, selectedStep, accordionStep, accordion) {
    if (selectedFilters && selectedStep !== accordionStep) {
        accordion.querySelector('.helper-selected-block').classList.add('visible');
        accordion.classList.add('complete');
      } else {
        accordion.querySelector('.helper-selected-block').classList.remove('visible');
        accordion.classList.remove('complete');
      }
  }
  
  function highlightSelectedWizardInputs() {
    var filters = queryStringToArray();
    var inputsList = document.querySelectorAll('.js-wizard-selector');
    
    inputsList.forEach(function(input) {
      if (filters.includes(input.value)) input.checked = true;
      else input.checked = false;
    })
  }
  
  function displayRelevantWizardContent(selectedStep) {    
    accordionsList.forEach(function(accordion) {
      var accordionType = accordion.dataset.type;
      var accordionStep = accordion.dataset.number;
      var selectedFilters = getUrlParameter(accordionType);
      
      openRelevantStepAccordion(selectedStep, accordionStep, accordion);
      highlightCompletedHeader(selectedFilters, selectedStep, accordionStep, accordion);
      displaySelectedHeaderValues(accordionType, selectedFilters, accordion);
    })
  }

  function scrollIntoHeader(number) {
    document.querySelector('[data-number="' + number + '"]').scrollIntoView();
  }
  
  function displayNextButton() {
    var nextButtonsList = document.querySelectorAll('[data-button-type]');
    
    nextButtonsList.forEach(function(button) {
      var type = button.dataset.buttonType;
      var checkedInputs = document.querySelectorAll('.js-wizard-selector[name="' + type + '"]:checked');
      if (checkedInputs.length) button.classList.add('visible');
      else button.classList.remove('visible');
    })
  }
  
  function onNavigationButtonClick(button) {
    var step = button.dataset.selector;
    setUrlParameter('step', step);
    displayRelevantContent(step);
    scrollIntoHeader(step);
  }
  
  function onSkipButtonClick() {
    clearUrlParameters();
    setUrlParameter('step', '5');
    displayRelevantContent();
  }
  
  function disableInputs(isDisabled) {
    var checkboxes = document.querySelectorAll('.js-wallet-selector:not(.platform-radio)');
    checkboxes.forEach(function(checkbox) {
      checkbox.disabled = isDisabled;
    })
  }
  
  function checkIfPlatformSelected(filters) {
    var platforms = [];
    var platfomrSelectors = document.querySelectorAll('.platform-radio');
    platfomrSelectors.forEach(function(selector) {
      platforms.push(selector.value)
    });
    for (var i = 0; i < platforms.length; i++) {
      var platform = platforms[i];
      if (filters.includes(platform)) return true;
    }
    return false;
  }
  
  function highlightCheckedSelectorInputs(filters) {
    if (checkIfPlatformSelected(filters)) {  
      selectorsList.forEach(function(selector) {
        if (filters.includes(selector.value)) selector.checked = true;
        else selector.checked = false;
      })
      disableInputs(false);
    } else disableInputs(true);
  }
  
  function setWalletsVisibility(filters) {
    linksList.forEach(function(link) {
      var categories = link.dataset.categories.split(' ');

      if (checkIfFiltersInclude(categories, filters) && checkIfPlatformSelected(filters)) link.classList.add('visible');
      else link.classList.remove('visible');
    });
  }
  
  function displaySelectedOs() {
    var selectedOs = document.querySelector('.js-platform-radio:checked');
    var selectedOsValue = selectedOs.value;
    if (selectedOsValue === 'ios') selectedOsValue = 'iOS';
    else selectedOsValue = selectedOsValue.charAt(0).toUpperCase() + selectedOsValue.slice(1);
    document.getElementById('selectedOs').textContent = selectedOsValue;
  }
  
  function displaySelectorSection(relevantSectionName) {
    var sectionsList = document.querySelectorAll('[data-section-name]')
    sectionsList.forEach(function(section) {
      if (section.dataset.sectionName ===  relevantSectionName) section.classList.add('visible');
      else section.classList.remove('visible');
    })
  }
  
  function displayRelevantSelectortSection(filters) {
    var visibleWallets = document.querySelectorAll('.wallet-link.visible');
    var selectedCategories = filters;
    var isWalletsVisible = !!visibleWallets.length;
    var isPlatformSelected = checkIfPlatformSelected(selectedCategories)
    
    if (!isWalletsVisible && !isPlatformSelected) {
      displaySelectorSection('browseWallets')
    } else if (!isWalletsVisible && selectedCategories) {
      displaySelectorSection('noMatch')
    } else {
      displaySelectorSection('walletsList')
      displaySelectedOs();
    }
  }
  
  function displayRelevantSelectorContent() {
    var filters = queryStringToArray();

    highlightCheckedSelectorInputs(filters);
    setWalletsVisibility(filters);
    displayRelevantSelectortSection(filters);
  }
  
  function checkParametersValues(parameterName, parameterValues) {
    var filters = parameterValues.split(',');
    var inputValues = [];
    var inputsList = document.getElementsByName(parameterName);
    inputsList.forEach(function(input) {
      inputValues.push(input.value);
    })
    
    for (var i = 0; i < filters.length; i++) {
      var filter = filters[i];
      if (!inputValues.includes(filter)) return false;
    }
    return true;
  }
  
  function verifyPreviousStepsChecks(step) {
    for (var i = step - 1; i > 0; i--) {
      var parameterName = document.querySelector('[data-number="' + i + '"]').dataset.type;
      var parameterValues = getUrlParameter(parameterName);
      if (!parameterValues || !checkParametersValues(parameterName, parameterValues)) return false;
    }
    return true;
  }
  function clearUrlParameters() {
    window.history.replaceState(null, null, window.location.pathname);
  }
  
  function displayRelevantContent() {
    var step = getUrlParameter('step');
    var currentStep = Number(step);
    var isWizardStep = currentStep > 0 && currentStep < 5;
    var isSelectorStep = currentStep === 5;
    if (isWizardStep && verifyPreviousStepsChecks(step)) {
      displayRelevantScreen('wizard');
      highlightSelectedWizardInputs();
      displayNextButton();
      displayRelevantWizardContent(step)
    } else if (isSelectorStep) {
      displayRelevantScreen('selector');
      displayRelevantSelectorContent();
    } else {
      displayRelevantScreen('intro');
    }
  }
    
  function collectCheckedInputsValues(selectedInputs) {
    var selectedInputsValues = [];
    selectedInputs.forEach(function(selectedInput) {
      selectedInputsValues.push(selectedInput.value);
    });
    return selectedInputsValues;
  }
  
  function onWizardInputChange(input) {
    var selectedInputs = document.querySelectorAll('.js-wizard-selector[name="' + input.name + '"]:checked');
    var filters = collectCheckedInputsValues(selectedInputs);
    setUrlParameter(input.name, filters);
    displayNextButton(input.name)
  }

  function onWalletSelectorInputChange(input) {
    var selectedInputs = document.querySelectorAll('.js-wallet-selector[name="' + input.name + '"]:checked');
    var filters = collectCheckedInputsValues(selectedInputs);
    setUrlParameter(input.name, filters);
    displayRelevantSelectorContent();
  }
  
  function setListners() {
    var navigationButtons = document.querySelectorAll('.js-helper-nav-btn');
    navigationButtons.forEach(function(button) {
      button.addEventListener('click', function() {
        onNavigationButtonClick(button);
      });
    });

    var wizardInputsList = document.querySelectorAll('.js-wizard-selector');
    wizardInputsList.forEach(function(input) {
      input.addEventListener('change', function() {
        onWizardInputChange(input);
      });
    });

    var skipButtons = document.querySelectorAll('.js-skip-btn');
    skipButtons.forEach(function(button) {
      button.addEventListener('click', onSkipButtonClick);
    });
    
    selectorsList.forEach(function(selector) {
      selector.addEventListener('change', function() {
        onWalletSelectorInputChange(selector)
      });
    });
    
    linksList.forEach(function(link) {
      link.addEventListener('click', function(e) {
        var href = this.getAttribute("href");
        location.href = href + window.location.search;
        e.preventDefault()
      });
    });

    window.addEventListener('popstate', (event) => {
      displayRelevantContent();
    });
  }
  
  function init() {
    displayRelevantContent();
    setListners();
  }

  init();
})();
</script>