{% comment %}
This file is licensed under the MIT License (MIT) available on
http://opensource.org/licenses/MIT.
{% endcomment %}

<div class="wallet-selector">
  <div class="container">
    
    <div class="wallet-selector-row">
      <div class="sidebar-selector"> 
        <div class="sidebar-selector-section">
          <h3 class="sidebar-selector-title">Operating System</h3>
          <div class="sidebar-selector-platforms">
            <div class="sidebar-selector-platforms-row">
              <div class="sidebar-selector-platform">
                <div class="sidebar-selector-label-row">
                  <h3 class="sidebar-selector-label">Mobile</h3>
                  <div class="sidebar-selector-info tooltip-trigger">
                    <img src="/img/icons/info-alt.svg" alt="info">
                    <div class="wallet-selector-tooltip tooltip">
                      Wallets are available for Android and iOS based operating systems.
                    </div>
                  </div>
                </div>
                <div class="sidebar-selector-os-row">
                  <label class="platform-radio-wrapper">
                    <input type="radio" class="platform-radio js-wallet-selector" name="platform" value="android"/>
                    <div class="platform-radio-custom">
                      <img src="/img/os/wallet_menu_android.svg" alt="android" class="platform-radio-icon-inactive">
                      <img src="/img/os/wallet_menu_android_bright.svg" alt="android" class="platform-radio-icon-active">
                    </div>
                  </label>
                  <label class="platform-radio-wrapper">
                    <input type="radio" class="platform-radio js-wallet-selector" name="platform" value="ios"/>
                    <div class="platform-radio-custom">
                      <img src="/img/os/wallet_menu_mac.svg" alt="ios" class="platform-radio-icon-inactive">
                      <img src="/img/os/wallet_menu_mac_bright.svg" alt="ios" class="platform-radio-icon-active">
                    </div>
                  </label>
                </div>
              </div>
              <div class="sidebar-selector-platform">
                <div class="sidebar-selector-label-row">
                  <h3 class="sidebar-selector-label">Desktop</h3>
                  <div class="sidebar-selector-info tooltip-trigger">
                    <img src="/img/icons/info-alt.svg" alt="info">
                    <div class="wallet-selector-tooltip tooltip">
                      Wallets are available for Linux, MacOS and Windows based operating systems.
                    </div>
                  </div>
                </div>
                <div class="sidebar-selector-os-row">
                  <label class="platform-radio-wrapper">
                    <input type="radio" class="platform-radio js-wallet-selector" name="platform" value="linux"/>
                    <div class="platform-radio-custom">
                      <img src="/img/os/wallet_menu_linux.svg" alt="linux" class="platform-radio-icon-inactive">
                      <img src="/img/os/wallet_menu_linux_bright.svg" alt="linux" class="platform-radio-icon-active">
                    </div>
                  </label>
                  <label class="platform-radio-wrapper">
                    <input type="radio" class="platform-radio js-wallet-selector" name="platform" value="mac"/>
                    <div class="platform-radio-custom">
                      <img src="/img/os/wallet_menu_mac.svg" alt="mac" class="platform-radio-icon-inactive">
                      <img src="/img/os/wallet_menu_mac_bright.svg" alt="mac" class="platform-radio-icon-active">
                    </div>
                  </label>
                  <label class="platform-radio-wrapper">
                    <input type="radio" class="platform-radio js-wallet-selector" name="platform" value="windows"/>
                    <div class="platform-radio-custom">
                      <img src="/img/os/wallet_menu_windows.svg" alt="windows" class="platform-radio-icon-inactive">
                      <img src="/img/os/wallet_menu_windows_bright.svg" alt="windows" class="platform-radio-icon-active">
                    </div>
                  </label>
                </div>
              </div>
            </div>
            <div class="sidebar-selector-platforms-row">
              <div class="sidebar-selector-platform">
                <div class="sidebar-selector-label-row">
                  <h3 class="sidebar-selector-label">Hardware</h3>
                  <div class="sidebar-selector-info tooltip-trigger">
                    <img src="/img/icons/info-alt.svg" alt="info">
                    <div class="wallet-selector-tooltip tooltip">
                      A hardware wallet is a high-security bitcoin wallet that enables you to store your funds offline. You connect it to your computer when you need to manage your funds.
                    </div>
                  </div>
                </div>
                <div class="sidebar-selector-os-row">
                  <label class="platform-radio-wrapper">
                    <input type="radio" class="platform-radio js-wallet-selector" name="platform" value="hardware"/>
                    <div class="platform-radio-custom">
                      <img src="/img/os/wallet_menu_hardware.svg" alt="hardware" class="platform-radio-icon-inactive">
                      <img src="/img/os/wallet_menu_hardware_bright.svg" alt="hardware" class="platform-radio-icon-active">
                    </div>
                  </label>
                </div>
              </div>
              <div class="sidebar-selector-platform">
                <div class="sidebar-selector-label-row">
                  <h3 class="sidebar-selector-label">Web</h3>
                  <div class="sidebar-selector-info tooltip-trigger">
                    <img src="/img/icons/info-alt.svg" alt="info">
                    <div class="wallet-selector-tooltip tooltip">
                      Web wallets are bitcoin wallets that are accessible using a web browser. No installation of additional software is needed.
                    </div>
                  </div>
                </div>
                <div class="sidebar-selector-os-row">
                  <label class="platform-radio-wrapper">
                    <input type="radio" class="platform-radio js-wallet-selector" name="platform" value="web"/>
                    <div class="platform-radio-custom">
                      <img src="/img/os/wallet_menu_web.svg" alt="web" class="platform-radio-icon-inactive">
                      <img src="/img/os/wallet_menu_web_bright.svg" alt="web" class="platform-radio-icon-active">
                    </div>
                  </label>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="sidebar-selector-section">
          <h3 class="sidebar-selector-title">User type</h3>
          <div class="user-radio-row">
            <label class="user-radio-wrapper">
              <input type="radio" class="user-radio js-wallet-selector" name="user" value="beginner"  />
              <p class="user-radio-text">New</p>
            </label>
            <div class="sidebar-selector-info tooltip-trigger">
              <img src="/img/icons/info-alt.svg" alt="info">
              <div class="wallet-selector-tooltip tooltip">
                Show wallets ideal for new bitcoin users, based on your search criteria.
              </div>
            </div>
          </div>
          <div class="user-radio-row">
            <label class="user-radio-wrapper">
              <input type="radio" class="user-radio js-wallet-selector" name="user" value="experienced" />
              <p class="user-radio-text">Experienced</p>
            </label>
            <div class="sidebar-selector-info tooltip-trigger">
              <img src="/img/icons/info-alt.svg" alt="info">
              <div class="wallet-selector-tooltip tooltip">
                Show all wallets, based on your search criteria.
              </div>
            </div>
          </div>
        </div>
        <div class="sidebar-selector-section">
          <div class="sidebar-selector-section-top">
            <h3 class="sidebar-selector-title">Criteria</h3>
          </div>
          <div class="important-checkbox-row">
            <label class="checkbox-wrapper">
              <input type="checkbox" name="important" value="control" class="checkbox js-wallet-selector" />
              <div class="checkbox-text">Control</div>
            </label>
            <div class="sidebar-selector-info tooltip-trigger">
              <img src="/img/icons/info-alt.svg" alt="info">
              <div class="wallet-selector-tooltip tooltip">
                Some wallets give you full control over your bitcoin. This means no third party can freeze or take away your funds. You are still responsible, however, for securing and backing up your wallet.
              </div>
            </div>
          </div>
          <div class="important-checkbox-row">
            <label class="checkbox-wrapper">
              <input type="checkbox" name="important" value="validation" class="checkbox js-wallet-selector" />
              <div class="checkbox-text">Validation</div>
            </label>
            <div class="sidebar-selector-info tooltip-trigger">
              <img src="/img/icons/info-alt.svg" alt="info">
              <div class="wallet-selector-tooltip tooltip">
                Some wallets have the ability to operate as a full node. This means no trust in a third party is required when processing transactions. Full nodes provide a high level of security, but they require a large amount of memory.
              </div>
            </div>
          </div>
          <div class="important-checkbox-row">
            <label class="checkbox-wrapper">
              <input type="checkbox" name="important" value="transparency" class="checkbox js-wallet-selector" />
              <div class="checkbox-text">Transparency</div>
            </label>
            <div class="sidebar-selector-info tooltip-trigger">
              <img src="/img/icons/info-alt.svg" alt="info">
              <div class="wallet-selector-tooltip tooltip">
                Some wallets are open-source and can be built deterministically, a process of compiling software which ensures the resulting code can be reproduced to help ensure it hasn't been tampered with.
              </div>
            </div>
          </div>
          <div class="important-checkbox-row">
            <label class="checkbox-wrapper">
              <input type="checkbox" name="important" value="environment" class="checkbox js-wallet-selector" />
              <div class="checkbox-text">Environment</div>
            </label>
            <div class="sidebar-selector-info tooltip-trigger">
              <img src="/img/icons/info-alt.svg" alt="info">
              <div class="wallet-selector-tooltip tooltip">
                Some wallets can be loaded on computers which are vulnerable to malware. Securing your computer, using a strong passphrase, moving most of your funds to cold store or enabling 2FA or multifactor authentication can help you protect your bitcoin.
              </div>
            </div>
          </div>
          <div class="important-checkbox-row">
            <label class="checkbox-wrapper">
              <input type="checkbox" name="important" value="fees" class="checkbox js-wallet-selector" />
              <div class="checkbox-text">Fees</div>
            </label>
            <div class="sidebar-selector-info tooltip-trigger">
              <img src="/img/icons/info-alt.svg" alt="info">
              <div class="wallet-selector-tooltip tooltip">
                Some wallets give you full control over setting the fee paid to the bitcoin network before making a transaction, or modifying it afterward, to ensure that your transactions are confirmed in a timely manner without paying more than you have to.
              </div>
            </div>
          </div>
          <div class="important-checkbox-row">
            <label class="checkbox-wrapper">
              <input type="checkbox" name="important" value="privacy" class="checkbox js-wallet-selector" />
              <div class="checkbox-text">Privacy</div>
            </label>
            <div class="sidebar-selector-info tooltip-trigger">
              <img src="/img/icons/info-alt.svg" alt="info">
              <div class="wallet-selector-tooltip tooltip">
                Some wallets make it harder to spy on your transactions by rotating addresses. They do not disclose information to peers on the network. They can also optionally let you setup and use Tor as a proxy to prevent others from associating transactions with your IP address.
              </div>
            </div>
          </div>
        </div>
        <div class="sidebar-selector-section">
          <div class="sidebar-selector-section-top">
            <h3 class="sidebar-selector-title">Features</h3>
          </div>
          <div class="important-checkbox-row">
            <label class="checkbox-wrapper">
              <input type="checkbox" name="features" value="2fa" class="checkbox js-wallet-selector" />
              <div class="checkbox-text">2FA</div>
            </label>
            <div class="sidebar-selector-info tooltip-trigger">
              <img src="/img/icons/info-alt.svg" alt="info">
              <div class="wallet-selector-tooltip tooltip">
                Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.
              </div>
            </div>
          </div>
          <div class="important-checkbox-row">
            <label class="checkbox-wrapper">
              <input type="checkbox" name="features" value="bech32" class="checkbox js-wallet-selector" />
              <div class="checkbox-text">Bech32</div>
            </label>
            <div class="sidebar-selector-info tooltip-trigger">
              <img src="/img/icons/info-alt.svg" alt="info">
              <div class="wallet-selector-tooltip tooltip">
                Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.
              </div>
            </div>
          </div>
          <div class="important-checkbox-row">
            <label class="checkbox-wrapper">
              <input type="checkbox" name="features" value="full_node" class="checkbox js-wallet-selector" />
              <div class="checkbox-text">Full Node</div>
            </label>
            <div class="sidebar-selector-info tooltip-trigger">
              <img src="/img/icons/info-alt.svg" alt="info">
              <div class="wallet-selector-tooltip tooltip">
                Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.
              </div>
            </div>
          </div>
          <div class="important-checkbox-row">
            <label class="checkbox-wrapper">
              <input type="checkbox" name="features" value="hardware_wallet" class="checkbox js-wallet-selector" />
              <div class="checkbox-text">Hardware Wallet</div>
            </label>
            <div class="sidebar-selector-info tooltip-trigger">
              <img src="/img/icons/info-alt.svg" alt="info">
              <div class="wallet-selector-tooltip tooltip">
                Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.
              </div>
            </div>
          </div>
          <div class="important-checkbox-row">
            <label class="checkbox-wrapper">
              <input type="checkbox" name="features" value="legacy_addresses" class="checkbox js-wallet-selector" />
              <div class="checkbox-text">Legacy Addresses</div>
            </label>
            <div class="sidebar-selector-info tooltip-trigger">
              <img src="/img/icons/info-alt.svg" alt="info">
              <div class="wallet-selector-tooltip tooltip">
                Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.
              </div>
            </div>
          </div>
          <div class="important-checkbox-row">
            <label class="checkbox-wrapper">
              <input type="checkbox" name="features" value="lightning" class="checkbox js-wallet-selector" />
              <div class="checkbox-text">Lightning</div>
            </label>
            <div class="sidebar-selector-info tooltip-trigger">
              <img src="/img/icons/info-alt.svg" alt="info">
              <div class="wallet-selector-tooltip tooltip">
                Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.
              </div>
            </div>
          </div>
          <div class="important-checkbox-row">
            <label class="checkbox-wrapper">
              <input type="checkbox" name="features" value="mixing_shuffling" class="checkbox js-wallet-selector" />
              <div class="checkbox-text">Mixing / Shuffling</div>
            </label>
            <div class="sidebar-selector-info tooltip-trigger">
              <img src="/img/icons/info-alt.svg" alt="info">
              <div class="wallet-selector-tooltip tooltip">
                Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.
              </div>
            </div>
          </div>
          <div class="important-checkbox-row">
            <label class="checkbox-wrapper">
              <input type="checkbox" name="features" value="multisig" class="checkbox js-wallet-selector" />
              <div class="checkbox-text">Multisig</div>
            </label>
            <div class="sidebar-selector-info tooltip-trigger">
              <img src="/img/icons/info-alt.svg" alt="info">
              <div class="wallet-selector-tooltip tooltip">
                Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.
              </div>
            </div>
          </div>
          <div class="important-checkbox-row">
            <label class="checkbox-wrapper">
              <input type="checkbox" name="features" value="segwit" class="checkbox js-wallet-selector" />
              <div class="checkbox-text">SegWit</div>
            </label>
            <div class="sidebar-selector-info tooltip-trigger">
              <img src="/img/icons/info-alt.svg" alt="info">
              <div class="wallet-selector-tooltip tooltip">
                Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.
              </div>
            </div>
          </div>
        </div>
        <h3 class="sidebar-selector-title">Need some help?</h3>
        <p class="sidebar-selector-text">You can find more information and help on the resources and community pages or on the Wiki FAQ</p>
      </div>

      <div class="wallet-selector-content">
        <div class="wallet-table-wrapper">        
          <div class="wallet-table">        
            <div class="wallet-table-row">
              <div class="wallet-table-head">
                <p class="wallet-table-title"><span id="selectedOs"></span> Wallets</p>
              </div>
              <div class="wallet-table-head">
                <p class="wallet-table-title">Control</p>
              </div>
              <div class="wallet-table-head">
                <p class="wallet-table-title">Validation</p>
              </div>
              <div class="wallet-table-head">
                <p class="wallet-table-title">Transparency</p>
              </div>
              <div class="wallet-table-head">
                <p class="wallet-table-title">Environment</p>
              </div>
              <div class="wallet-table-head">
                <p class="wallet-table-title">Fees</p>
              </div>
              <div class="wallet-table-head">
                <p class="wallet-table-title">Privacy</p>
              </div>
            </div>
          
            {% for wallet in site.wallets %}
              {% for platform in wallet.platform %}
                {% for os in platform.os %}
                  <a
                    href="{% if platform.name == os.name %}/{{page.lang}}/wallets/{{platform.name}}/{{wallet.id}}/{% else %}/{{page.lang}}/wallets/{{platform.name}}/{{os.name}}/{{wallet.id}}/{% endif %}"
                    class="wallet-table-row wallet-link"
                    data-categories="{% if wallet.user %}{{wallet.user}}{% endif %} experienced {% for check in os.check %}{% assign checkValue = check[1] %}{% assign checkName = check[0] %}{% if checkValue contains 'checkgood' or checkValue contains 'checkpass' %}{{checkName}} {% endif %}{% endfor %}{{os.name}}"
                  >
                    <div class="wallet-table-data">
                      <img class="wallet-img" src="/img/wallet/{{ wallet.id }}.png?{{site.time | date: '%s'}}" alt="{{ wallet.title }}" />
                      <span class="wallet-label">{{wallet.titleshort}}</span>
                    </div>
                    {% for check in os.check %}
                      {% assign checkName = check[0] %}
                      {% assign checkValue = check[1] %}
                      <div class="wallet-table-data">
                        <div class="wallet-{% if checkValue contains 'checkgood' %}good{% elsif checkValue contains 'checkpass' %}good{% elsif checkValue contains 'checkfail' %}caution{% elsif checkValue contains 'checkneutral' %}neutral{% endif %}"></div>
                      </div>
                    {% endfor %}
                  </a>
                {% endfor %}
              {% endfor %}
            {% endfor %}
          </div>

          <div class="wallet-hints-row">
            <div class="wallet-hint">
              <div class="wallet-good"></div>
              <p class="wallet-hint-text">- Good</p>
            </div>
            <div class="wallet-hint">
              <div class="wallet-caution"></div>
              <p class="wallet-hint-text">- Caution</p>
            </div>
            <div class="wallet-hint">
              <div class="wallet-neutral"></div>
              <p class="wallet-hint-text">- Neutral</p>
            </div>
          </div>
          
        </div>


        <div class="empty-box no-matching-box hidden">
          <img src="/img/icons/empty.svg" alt="wallet with magnifier">
          <h2 class="empty-box-title">No matching wallets found</h2>
          <p class="empty-box-text">Please update your search criteria and try again.</p>
        </div>

        <div class="empty-box browse-wallets-box hidden">
          <img src="/img/icons/empty.svg" alt="wallet with magnifier">
          <h2 class="empty-box-title">Browse wallets</h2>
          <p class="empty-box-text">Use the wallet selector to find wallets that
          match your search criteria.</p>
        </div>
      </div>

    </div>
  </div>
</div>  

<script>
  var queries = {};
  
  var linksList = document.querySelectorAll('.wallet-link');  
  var selectorsList = document.querySelectorAll('.js-wallet-selector');
  function setListners() {
    selectorsList.forEach(function(selector) {
      selector.addEventListener('change', function() {
        var filters = []
        var selectedInputs = document.querySelectorAll('.js-wallet-selector:checked');
        selectedInputs.forEach(function(input) {
          filters.push(input.value);
        });
        renderContent(filters);
      });
    });
    
    linksList.forEach(function(link) {
      link.addEventListener('click', function(e) {
        var href = this.getAttribute("href");
        location.href = href + window.location.search;
        e.preventDefault()
      });
    });
  }
  
  function displayContentSections() {
    var visibleWallets = document.querySelectorAll('.wallet-link.visible');
    var walletsTable = document.querySelector('.wallet-table-wrapper');
    var noMatchBox = document.querySelector('.no-matching-box');
    var browseBox = document.querySelector('.browse-wallets-box');
    var selectedCategories = getUrlParameter('filters').split(',');
    var isCategoriesSelected = !!selectedCategories.length;
    var isWalletsVisible = !!visibleWallets.length;
    var isPlatformSelected = checkIfPlatformSelected(selectedCategories)
    
    if (!isWalletsVisible && !isPlatformSelected) {
      browseBox.classList.remove('hidden');
      noMatchBox.classList.add('hidden');
      walletsTable.classList.add('hidden');
    } else if (!isWalletsVisible && selectedCategories) {
      noMatchBox.classList.remove('hidden');
      walletsTable.classList.add('hidden');
      browseBox.classList.add('hidden');
    } else {
      walletsTable.classList.remove('hidden');
      browseBox.classList.add('hidden');
      noMatchBox.classList.add('hidden');
    }
  }

  function setWalletsVisibility(filters) {
    linksList.forEach(function(link) {
      var categories = link.dataset.categories.split(' ');
      if (checkIfFiltersInclude(categories, filters) && checkIfPlatformSelected(filters)) link.classList.add('visible');
      else link.classList.remove('visible');
    });
  }
  
  function disableInputs(isDisabled) {
    var checkboxes = document.querySelectorAll('.js-wallet-selector:not(.platform-radio)');
    checkboxes.forEach(function(checkbox) {
      checkbox.disabled = isDisabled;
    })
  }

  function checkIfPlatformSelected(filters) {
    var platforms = [];
    var platfomrSelectors = document.querySelectorAll('.platform-radio');
    platfomrSelectors.forEach(function(selector) {
      platforms.push(selector.value)
    });
    for (var i = 0; i < platforms.length; i++) {
      var platform = platforms[i];
      if (filters.includes(platform)) return true;
    }
    return false;
  }

  function setInputActivity() {
    var platformSelectors = document.querySelectorAll('.platform-radio:checked');
    if (platformSelectors.length) disableInputs(false);
    else disableInputs(true);
  }
  
  function displaySelectedOs() {
    var selectedOs = document.querySelector('.js-wallet-selector:checked');
    if (selectedOs) {  
      var selectedOsValue = selectedOs.value;
      if (selectedOsValue === 'ios') selectedOsValue = 'iOS';
      else selectedOsValue = selectedOsValue.charAt(0).toUpperCase() + selectedOsValue.slice(1);
      document.getElementById('selectedOs').textContent = selectedOsValue;
    }
  }
  
  function renderContent(filters) {
    setWalletsVisibility(filters);
    setInputActivity();
    displayContentSections();
    setUrlParameter('filters', filters);
    displaySelectedOs();
  }

  function selectCheckedInputs(filters) {
    if (checkIfPlatformSelected(filters)) {  
      selectorsList.forEach(function(selector) {
        if (filters.includes(selector.value)) selector.checked = true;
        else selector.checked = false;
      })
    } 
  }
  
  function init() {
    var defaultParameters = getUrlParameter('filters').split(',');
    selectCheckedInputs(defaultParameters)
    renderContent(defaultParameters);
    setListners();
  }

  init()
  
</script>
