{% comment %}
This file is licensed under the MIT License (MIT) available on
http://opensource.org/licenses/MIT.
{% endcomment %}

<div class="helper">
  <div class="container">
    {% include layout/base/helper-intro.html %}
    {% include layout/base/helper-wizard.html %}
  </div>
</div>

<script>
(function() {
  var selectedPlatform;
  var selectedUser;
  var selectedImportantCheckboxes = [];
  var selectedImportantCheckboxes = [];
  var headersList = document.querySelectorAll('.helper-header');
  
  function displayRelevantStep(selectedStep) {
    var sectionsList = document.querySelectorAll('.helper-step');
    if (selectedStep !== '0') onNextIntroButtonClick();
    sectionsList.forEach(function(section) {
      if (section.dataset.step === selectedStep) section.classList.add('visible');
      else section.classList.remove('visible');
    })
  }
  
  function displaySelectedHeaderValues() {
    headersList.forEach(function(header) {
      var headerType = header.dataset.type;
      var selectedFilters = getUrlParameter(headerType);
      
      if (selectedFilters) {
        var text = document.querySelector('input[value=' + selectedFilters + ']').dataset.text;
        header.querySelector('.helper-selected-filter').textContent = text;
      }
    })
  }
  
  function highlightRelevantHeader(step) {    
    step = Number(step);
    
    headersList.forEach(function(header) {
      var headerType = header.dataset.type;
      var headerStep = Number(header.dataset.number);
      
      if (headerStep === step) header.classList.add('active');
      else header.classList.remove('active');

      var selectedFilters = getUrlParameter(headerType);
      if (selectedFilters && headerStep !== step) header.querySelector('.helper-selected-block').classList.add('visible');
      else header.querySelector('.helper-selected-block').classList.remove('visible');
    })      
  }
  
  function onNextIntroButtonClick() {
    var wizard = document.querySelector('.js-wizard');
    wizard.classList.add('visible')
  }
  
  function onPlatformRadioChange(radio) {
    var nextButton = document.querySelector('.js-platform-next');
    nextButton.classList.add('visible');
    setUrlParameter(radio.name, radio.value);
    displaySelectedHeaderValues();
  }
  
  function onUserRadioChange(radio) {
    var nextButton = document.querySelector('.js-platform-next');
    var selectedPlatformText = document.querySelector('.js-selected-user');
  }
  
  function setListners() {
    var nextButtons = document.querySelectorAll('.js-helper-next')
    nextButtons.forEach(function(button) {
      button.addEventListener('click', function() {
        var step = this.dataset.selector;
        displayRelevantStep(step);
        setUrlParameter('step', step);
        highlightRelevantHeader(step);
      });
    });

    var backButtons = document.querySelectorAll('.js-helper-back');
    backButtons.forEach(function(button) {
      button.addEventListener('click', function() {
        var step = this.dataset.selector;
        displayRelevantStep(step);
        setUrlParameter('step', step);
        highlightRelevantHeader(step);
      });
    });

    var platformRadioList = document.querySelectorAll('.js-helper-platform');
    platformRadioList.forEach(function(radio) {
      radio.addEventListener('change', function() {
        onPlatformRadioChange(radio);
        displaySelectedHeaderValues(radio.dataset.text);
      });
    });

    var userRadioList = document.querySelectorAll('.js-helper-user');
    userRadioList.forEach(function(radio) {
      radio.addEventListener('change', function() {
        onUserRadioChange(radio);
      });
    });
  }
  
  function displayDefaultContent(step) {
    if (step) {
      displayRelevantStep(step);
      highlightRelevantHeader(step)
      displaySelectedHeaderValues();
    } else displayRelevantStep('0');
  }
  
  function init() {
    var step = getUrlParameter('step');
    displayDefaultContent(step);
    highlightRelevantHeader(step);
    setListners();
  }

  init();
})();
</script>